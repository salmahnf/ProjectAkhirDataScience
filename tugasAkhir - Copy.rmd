---
title: "tugasAkhir"
author: "SalmaHanifa_123220019"
date: "2024-12-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

---
title: "Modeling Harga Properti di Yogyakarta"
author: "Salma Hanifa"
output: html_document
---

## 1. Memuat Data

```{r}
# Import Library
library(tidyverse)
library(tidymodels)
library(caret)
library(randomForest)
library(ggplot2)

# Memuat dataset yang telah dibersihkan
data <- read.csv("rumah_cleaned.csv")

# Melihat 6 baris pertama dari dataset
head(data)

```

2. Membersihkan dan Menambahkan Fitur Baru
Menambah beberapa fitur baru yang mungkin membantu model prediksi.
```{r}
# Menambah fitur harga per meter persegi (price per square meter)
data$price_per_m2 <- data$price / (data$luas_tanah + 1)  # Menambahkan 1 untuk menghindari pembagian dengan 0

# Menambah rasio luas bangunan terhadap luas tanah
data$building_to_land_ratio <- data$luas_bangunan / data$luas_tanah

# Melihat hasil perubahan data
head(data)

```

```{r}
# Identifikasi dan hapus outlier berdasarkan IQR
Q1 <- quantile(data$price, 0.25)
Q3 <- quantile(data$price, 0.75)
IQR <- Q3 - Q1

# Hitung batas bawah dan batas atas untuk outlier
lower_bound <- Q1 - 1.5 * IQR
upper_bound <- Q3 + 1.5 * IQR

# Hapus outlier (data yang berada di luar batas bawah dan atas)
data_clean <- data %>% filter(price >= lower_bound & price <= upper_bound)

# Visualisasi boxplot setelah menghapus outlier
ggplot(data_clean, aes(x = "", y = price)) + 
  geom_boxplot(outlier.colour = "red", outlier.shape = 8) +
  labs(title = "Boxplot Harga Rumah Setelah Menghapus Outlier", y = "Harga Rumah")
```


3. Memisahkan Data untuk Training dan Testing
Kita akan membagi data menjadi training dan testing set.
```{r}
# Membagi data menjadi fitur (X) dan target (y)
X <- data_clean %>% select(-price)  # Semua kolom kecuali 'price'
y <- data_clean$price  # Target adalah kolom 'price'

# Membagi data menjadi training dan testing set
set.seed(123)
train_index <- sample(1:nrow(X), size = 0.8 * nrow(X))
X_train <- X[train_index, ]
y_train <- y[train_index]
X_test <- X[-train_index, ]
y_test <- y[-train_index]

```

4. Membuat dan Melatih Model
model Random Forest
```{r}
# Membuat model Random Forest
rf_model <- randomForest(x = X_train, y = y_train, ntree = 100, random_state = 42)

# Melihat hasil model
print(rf_model)

# Memprediksi harga dengan model Random Forest
rf_pred <- predict(rf_model, X_test)

# Menghitung evaluasi model
rf_mae <- mean(abs(rf_pred - y_test))  # Mean Absolute Error
rf_mse <- mean((rf_pred - y_test)^2)  # Mean Squared Error
rf_r2 <- 1 - sum((rf_pred - y_test)^2) / sum((y_test - mean(y_test))^2)  # R² Score

# Menampilkan hasil evaluasi
cat("Random Forest MAE:", rf_mae, "\n")
cat("Random Forest MSE:", rf_mse, "\n")
cat("Random Forest R²:", rf_r2, "\n")

# Menghitung RMSE (Root Mean Squared Error)
rf_rmse <- sqrt(rf_mse)

# Menampilkan RMSE
cat("Random Forest RMSE:", rf_rmse, "\n")

# Menyusun data metrik evaluasi ke dalam data frame
evaluation_metrics <- data.frame(
  Metric = c("MAE", "MSE", "RMSE", "R²"),
  Value = c(rf_mae, rf_mse, rf_rmse, rf_r2)
)

# Menampilkan data frame untuk memeriksa nilai-nilai metrik
print(evaluation_metrics)

# Membuat bar plot untuk menampilkan metrik evaluasi
ggplot(evaluation_metrics, aes(x = Metric, y = Value, color = Metric)) +
  geom_point(size = 4) +  # Membuat titik scatter
  labs(title = "Model Performance Evaluation",
       x = "Evaluation Metric",
       y = "Value") +
  theme_minimal() +
  scale_color_brewer(palette = "Set3")  # Menambahkan warna untuk titik
```

```{r}
# Memuat library yang diperlukan
library(caret)
library(randomForest)

# Menentukan grid untuk hyperparameter tuning
tune_grid <- expand.grid(mtry = c(2, 3, 4, 5, 6))  # Coba berbagai nilai mtry

# Cross-validation untuk Random Forest dengan 10-fold
rf_grid_search <- train(price ~ ., data = train_data,
                        method = "rf",
                        trControl = trainControl(method = "cv", number = 10),
                        tuneGrid = tune_grid)

# Menampilkan hasil grid search
print(rf_grid_search)

# Menggunakan model terbaik berdasarkan mtry dari grid search
best_rf_model <- rf_grid_search$finalModel

# Memprediksi harga dengan model terbaik
rf_best_pred <- predict(best_rf_model, test_data)

# Menghitung evaluasi model
rf_best_mae <- mean(abs(rf_best_pred - test_data$price))  # Mean Absolute Error
rf_best_mse <- mean((rf_best_pred - test_data$price)^2)  # Mean Squared Error
rf_best_r2 <- 1 - sum((rf_best_pred - test_data$price)^2) / sum((test_data$price - mean(test_data$price))^2)  # R² Score

# Menampilkan hasil evaluasi
cat("Tuned Random Forest MAE:", rf_best_mae, "\n")
cat("Tuned Random Forest MSE:", rf_best_mse, "\n")
cat("Tuned Random Forest R²:", rf_best_r2, "\n")

```

